{"name":"Gmail AIåˆ†æãƒ»æ‰¿èªãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼","nodes":[{"parameters":{"content":"## Gmail AIåˆ†æãƒ»æ‰¿èªãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼\n\n### å½¹å‰²ãƒ»ç›®çš„\nGmailã«å±Šããƒ¡ãƒ¼ãƒ«ã‚’AIãŒè‡ªå‹•åˆ†æã—ã€è¿”ä¿¡æ¡ˆã‚’ç”Ÿæˆã€‚Slackã§æ‰¿èªãƒ•ãƒ­ãƒ¼ã‚’å®Ÿè¡Œã—ã€äººé–“ã®æœ€çµ‚åˆ¤æ–­ã‚’çµŒã¦ãƒ¡ãƒ¼ãƒ«é€ä¿¡ã‚’è¡Œã„ã¾ã™ã€‚\n\n### ãƒ•ãƒ­ãƒ¼æ¦‚è¦\n1. Gmailå—ä¿¡ â†’ 2. AIãƒˆãƒªã‚¢ãƒ¼ã‚¸ â†’ 3. è¿”ä¿¡è¦å¦åˆ¤å®š â†’ 4. AIè¿”ä¿¡æ¡ˆç”Ÿæˆ â†’ 5. Gmailä¸‹æ›¸ãä¿å­˜ â†’ 6. Sheetsè¨˜éŒ² â†’ 7. Slackæ‰¿èªä¾é ¼\n\n### ä½¿ç”¨ãƒ„ãƒ¼ãƒ«\n- **Gmail Trigger**: æ–°ç€ãƒ¡ãƒ¼ãƒ«æ¤œçŸ¥\n- **AI Agent (ãƒˆãƒªã‚¢ãƒ¼ã‚¸)**: è¿”ä¿¡è¦å¦ãƒ»é‡è¦åº¦ãƒ»ã‚¸ãƒ£ãƒ³ãƒ«åˆ¤å®š\n- **AI Agent (è¿”ä¿¡ç”Ÿæˆ)**: ã‚¸ãƒ£ãƒ³ãƒ«åˆ¥è¿”ä¿¡æ¡ˆä½œæˆ\n- **Gmail**: ä¸‹æ›¸ãä¿å­˜\n- **Google Sheets**: åˆ†æçµæœè¨˜éŒ²\n- **Slack**: æ‰¿èªä¾é ¼é€ä¿¡\n\n### â˜…è¦è¨­å®šé …ç›®\n1. **Gmail Trigger/Gmail**: Gmail OAuth2èªè¨¼\n2. **Anthropic Chat Model**: Anthropic API Key\n3. **Google Sheets**: OAuth2èªè¨¼ã€ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆID\n4. **Slack**: OAuth2èªè¨¼ã€æ‰¿èªè€…ãƒ¦ãƒ¼ã‚¶ãƒ¼ID\n\n### é–¢é€£ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼\n- WF2: Slackæ‰¿èªã‚¢ã‚¯ã‚·ãƒ§ãƒ³å‡¦ç†\n- WF3: æ‰‹å‹•é€ä¿¡è¿½è·¡ï¼ˆ15åˆ†é–“éš”ï¼‰\n\n### äº‹å‰æº–å‚™\nGoogle Sheetsã«ä»¥ä¸‹ã®ã‚·ãƒ¼ãƒˆã‚’ä½œæˆ:\n- å•ã„åˆã‚ã› / è¦‹ç©ä¾é ¼ / ã‚¯ãƒ¬ãƒ¼ãƒ  / å ±å‘Š / ãŠçŸ¥ã‚‰ã› / ãã®ä»–","height":620,"width":480,"color":7},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[-180,-80],"id":"sticky-overview","name":"æ¦‚è¦"},{"parameters":{"content":"## 1. ãƒˆãƒªã‚¬ãƒ¼ & AIãƒˆãƒªã‚¢ãƒ¼ã‚¸\n\nGmailæ–°ç€ãƒ¡ãƒ¼ãƒ«ã‚’å—ä¿¡ã—ã€AIãŒè¿”ä¿¡è¦å¦ãƒ»é‡è¦åº¦ãƒ»ã‚¸ãƒ£ãƒ³ãƒ«ã‚’åˆ¤å®šã—ã¾ã™ã€‚","height":140,"width":320,"color":4},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[340,-80],"id":"sticky-trigger","name":"ãƒˆãƒªã‚¬ãƒ¼èª¬æ˜"},{"parameters":{"content":"## 2. è¿”ä¿¡æ¡ˆç”Ÿæˆ & ä¸‹æ›¸ãä¿å­˜\n\nè¿”ä¿¡ãŒå¿…è¦ãªãƒ¡ãƒ¼ãƒ«ã«å¯¾ã—ã€ã‚¸ãƒ£ãƒ³ãƒ«ã«å¿œã˜ãŸè¿”ä¿¡æ¡ˆã‚’ç”Ÿæˆã—Gmailä¸‹æ›¸ãã¨ã—ã¦ä¿å­˜ã—ã¾ã™ã€‚","height":140,"width":360,"color":5},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[1100,-80],"id":"sticky-reply","name":"è¿”ä¿¡ç”Ÿæˆèª¬æ˜"},{"parameters":{"content":"## 3. è¨˜éŒ² & æ‰¿èªä¾é ¼\n\nGoogle Sheetsã«ã‚¸ãƒ£ãƒ³ãƒ«åˆ¥ã§è¨˜éŒ²ã—ã€Slackã§æ‰¿èªä¾é ¼ã‚’é€ä¿¡ã—ã¾ã™ã€‚","height":140,"width":340,"color":6},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[1780,-80],"id":"sticky-approval","name":"æ‰¿èªèª¬æ˜"},{"parameters":{"pollTimes":{"item":[{"mode":"everyMinute"}]},"filters":{"readStatus":"unread"},"options":{}},"type":"n8n-nodes-base.gmailTrigger","typeVersion":1.2,"position":[380,120],"id":"gmail-trigger","name":"Gmail Trigger","credentials":{"gmailOAuth2":{"id":"","name":"Gmail OAuth2"}}},{"parameters":{"mode":"runOnceForAllItems","jsCode":"// ãƒ¡ãƒ¼ãƒ«ãƒ‡ãƒ¼ã‚¿ã‚’æ•´å½¢ã—ã¦AIåˆ†æç”¨ã«æº–å‚™\nconst items = $input.all();\nconst results = [];\n\nfor (const item of items) {\n  const email = item.json;\n  \n  results.push({\n    json: {\n      messageId: email.id || email.messageId,\n      threadId: email.threadId,\n      from: email.from || '',\n      to: email.to || '',\n      subject: email.subject || '(ä»¶åãªã—)',\n      body: (email.text || email.snippet || '').substring(0, 3000),\n      receivedAt: email.date || new Date().toISOString(),\n      labels: email.labelIds || []\n    }\n  });\n}\n\nreturn results;"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[560,120],"id":"code-prepare","name":"ãƒ‡ãƒ¼ã‚¿æº–å‚™"},{"parameters":{"promptType":"define","text":"=ä»¥ä¸‹ã®ãƒ¡ãƒ¼ãƒ«ã‚’åˆ†æã—ã¦ãã ã•ã„ã€‚\n\nã€å·®å‡ºäººã€‘{{ $json.from }}\nã€ä»¶åã€‘{{ $json.subject }}\nã€æœ¬æ–‡ã€‘\n{{ $json.body }}","hasOutputParser":true,"options":{"systemMessage":"ã‚ãªãŸã¯ãƒ¡ãƒ¼ãƒ«ãƒˆãƒªã‚¢ãƒ¼ã‚¸ã®å°‚é–€å®¶ã§ã™ã€‚å—ä¿¡ãƒ¡ãƒ¼ãƒ«ã‚’åˆ†æã—ã€ä»¥ä¸‹ã®3ç‚¹ã‚’åˆ¤å®šã—ã¦ãã ã•ã„ã€‚\n\n1. è¿”ä¿¡è¦å¦ (isReplyNeeded): true/false\n   - è‡ªå‹•é€šçŸ¥ã€åºƒå‘Šã€ãƒ‹ãƒ¥ãƒ¼ã‚¹ãƒ¬ã‚¿ãƒ¼ â†’ false\n   - è³ªå•ã€ä¾é ¼ã€ã‚¯ãƒ¬ãƒ¼ãƒ  â†’ true\n\n2. é‡è¦åº¦ (priority): high/medium/low\n   - ç·Šæ€¥ã€è‡³æ€¥ã€æœ¬æ—¥ä¸­ã€ã‚¯ãƒ¬ãƒ¼ãƒ  â†’ high\n   - ä¸€èˆ¬çš„ãªå•ã„åˆã‚ã›ã€ä¾é ¼ â†’ medium\n   - ãŠçŸ¥ã‚‰ã›ã€CCå—ä¿¡ã€æƒ…å ±å…±æœ‰ â†’ low\n\n3. ã‚¸ãƒ£ãƒ³ãƒ« (genre): ä»¥ä¸‹ã®ã„ãšã‚Œã‹\n   - å•ã„åˆã‚ã›\n   - è¦‹ç©ä¾é ¼\n   - ã‚¯ãƒ¬ãƒ¼ãƒ \n   - å ±å‘Š\n   - ãŠçŸ¥ã‚‰ã›\n   - ãã®ä»–"}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":1.7,"position":[740,120],"id":"ai-triage","name":"AIãƒˆãƒªã‚¢ãƒ¼ã‚¸"},{"parameters":{"modelId":{"__rl":true,"mode":"list","value":"claude-3-haiku-20240307"},"options":{"maxTokensToSample":1024,"temperature":0.2}},"type":"@n8n/n8n-nodes-langchain.lmChatAnthropic","typeVersion":1.3,"position":[620,320],"id":"llm-triage","name":"Claude (ãƒˆãƒªã‚¢ãƒ¼ã‚¸)","credentials":{"anthropicApi":{"id":"","name":"Anthropic API"}}},{"parameters":{"schemaType":"manual","inputSchema":"{\n  \"type\": \"object\",\n  \"properties\": {\n    \"isReplyNeeded\": {\n      \"type\": \"boolean\",\n      \"description\": \"è¿”ä¿¡ãŒå¿…è¦ã‹ã©ã†ã‹\"\n    },\n    \"priority\": {\n      \"type\": \"string\",\n      \"description\": \"é‡è¦åº¦ (high/medium/low)\"\n    },\n    \"genre\": {\n      \"type\": \"string\",\n      \"description\": \"ã‚¸ãƒ£ãƒ³ãƒ« (å•ã„åˆã‚ã›/è¦‹ç©ä¾é ¼/ã‚¯ãƒ¬ãƒ¼ãƒ /å ±å‘Š/ãŠçŸ¥ã‚‰ã›/ãã®ä»–)\"\n    }\n  },\n  \"required\": [\"isReplyNeeded\", \"priority\", \"genre\"]\n}"},"type":"@n8n/n8n-nodes-langchain.outputParserStructured","typeVersion":1.2,"position":[740,320],"id":"parser-triage","name":"ãƒˆãƒªã‚¢ãƒ¼ã‚¸Parser"},{"parameters":{"mode":"runOnceForAllItems","jsCode":"// AIãƒˆãƒªã‚¢ãƒ¼ã‚¸çµæœã‚’å…ƒãƒ‡ãƒ¼ã‚¿ã¨ãƒãƒ¼ã‚¸\nconst items = $input.all();\nconst preparedData = $('ãƒ‡ãƒ¼ã‚¿æº–å‚™').all();\nconst results = [];\n\nfor (let i = 0; i < items.length; i++) {\n  const aiResult = items[i].json.output || items[i].json;\n  const original = preparedData[i]?.json || {};\n  \n  // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã§ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³\n  const validPriorities = ['high', 'medium', 'low'];\n  const validGenres = ['å•ã„åˆã‚ã›', 'è¦‹ç©ä¾é ¼', 'ã‚¯ãƒ¬ãƒ¼ãƒ ', 'å ±å‘Š', 'ãŠçŸ¥ã‚‰ã›', 'ãã®ä»–'];\n  \n  results.push({\n    json: {\n      ...original,\n      isReplyNeeded: aiResult.isReplyNeeded === true,\n      priority: validPriorities.includes(aiResult.priority) ? aiResult.priority : 'medium',\n      genre: validGenres.includes(aiResult.genre) ? aiResult.genre : 'ãã®ä»–',\n      analyzedAt: new Date().toISOString()\n    }\n  });\n}\n\nreturn results;"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[920,120],"id":"code-merge-triage","name":"ãƒˆãƒªã‚¢ãƒ¼ã‚¸çµæœãƒãƒ¼ã‚¸"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict"},"conditions":[{"id":"reply-needed","leftValue":"={{ $json.isReplyNeeded }}","rightValue":true,"operator":{"type":"boolean","operation":"equals"}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[1100,120],"id":"if-reply-needed","name":"è¿”ä¿¡è¦å¦åˆ¤å®š"},{"parameters":{"promptType":"define","text":"=ä»¥ä¸‹ã®ãƒ¡ãƒ¼ãƒ«ã«å¯¾ã™ã‚‹è¿”ä¿¡æ¡ˆã‚’ä½œæˆã—ã¦ãã ã•ã„ã€‚\n\nã€ã‚¸ãƒ£ãƒ³ãƒ«ã€‘{{ $json.genre }}\nã€é‡è¦åº¦ã€‘{{ $json.priority }}\nã€å·®å‡ºäººã€‘{{ $json.from }}\nã€ä»¶åã€‘{{ $json.subject }}\nã€æœ¬æ–‡ã€‘\n{{ $json.body }}","hasOutputParser":true,"options":{"systemMessage":"ã‚ãªãŸã¯ãƒ“ã‚¸ãƒã‚¹ãƒ¡ãƒ¼ãƒ«ã®è¿”ä¿¡ä½œæˆã®å°‚é–€å®¶ã§ã™ã€‚\n\nã€ã‚¸ãƒ£ãƒ³ãƒ«åˆ¥ãƒˆãƒ¼ãƒ³ã€‘\n- å•ã„åˆã‚ã›: ä¸å¯§ã§è¦ªåˆ‡ã€å…·ä½“çš„ãªå›ç­”ã‚’å¿ƒãŒã‘ã‚‹\n- è¦‹ç©ä¾é ¼: ãƒ•ã‚©ãƒ¼ãƒãƒ«ã§æ­£ç¢ºã€é‡‘é¡ã¯ä»®ç½®ãã§å¾Œæ—¥é€£çµ¡ã¨è¨˜è¼‰\n- ã‚¯ãƒ¬ãƒ¼ãƒ : èª å®Ÿã§è¬ç½ªã‚’å«ã‚€ã€è§£æ±ºç­–ã‚’æç¤º\n- å ±å‘Š: ç°¡æ½”ã«å—é ˜ç¢ºèªã¨æ¬¡ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’æ˜ç¤º\n- ãŠçŸ¥ã‚‰ã›: æ„Ÿè¬ã®æ„ã‚’ç¤ºã—ã€ç°¡æ½”ã«å¯¾å¿œ\n- ãã®ä»–: çŠ¶æ³ã«å¿œã˜ã¦é©åˆ‡ãªãƒˆãƒ¼ãƒ³ã§\n\nã€é‡è¦åº¦å¯¾å¿œã€‘\n- high: è‡³æ€¥å¯¾å¿œã™ã‚‹æ—¨ã‚’æ˜è¨˜\n- medium: é€šå¸¸ã®å¯¾å¿œé€Ÿåº¦\n- low: å¯¾å¿œäºˆå®šã‚’ä¼ãˆã‚‹ç¨‹åº¦\n\nè¿”ä¿¡ã¯æ—¥æœ¬èªã§ã€200-400æ–‡å­—ç¨‹åº¦ã§ä½œæˆã—ã¦ãã ã•ã„ã€‚"}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":1.7,"position":[1320,60],"id":"ai-reply","name":"AIè¿”ä¿¡ç”Ÿæˆ"},{"parameters":{"modelId":{"__rl":true,"mode":"list","value":"claude-3-haiku-20240307"},"options":{"maxTokensToSample":2048,"temperature":0.4}},"type":"@n8n/n8n-nodes-langchain.lmChatAnthropic","typeVersion":1.3,"position":[1200,260],"id":"llm-reply","name":"Claude (è¿”ä¿¡)","credentials":{"anthropicApi":{"id":"","name":"Anthropic API"}}},{"parameters":{"schemaType":"manual","inputSchema":"{\n  \"type\": \"object\",\n  \"properties\": {\n    \"replyDraft\": {\n      \"type\": \"string\",\n      \"description\": \"è¿”ä¿¡ãƒ¡ãƒ¼ãƒ«ã®æœ¬æ–‡\"\n    }\n  },\n  \"required\": [\"replyDraft\"]\n}"},"type":"@n8n/n8n-nodes-langchain.outputParserStructured","typeVersion":1.2,"position":[1320,260],"id":"parser-reply","name":"è¿”ä¿¡Parser"},{"parameters":{"mode":"runOnceForAllItems","jsCode":"// AIè¿”ä¿¡çµæœã‚’å…ƒãƒ‡ãƒ¼ã‚¿ã¨ãƒãƒ¼ã‚¸\nconst items = $input.all();\nconst triageData = $('è¿”ä¿¡è¦å¦åˆ¤å®š').all();\nconst results = [];\n\nfor (let i = 0; i < items.length; i++) {\n  const aiResult = items[i].json.output || items[i].json;\n  const original = triageData[i]?.json || {};\n  \n  const replyDraft = aiResult.replyDraft || 'ã”é€£çµ¡ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™ã€‚å†…å®¹ã‚’ç¢ºèªã®ä¸Šã€æ”¹ã‚ã¦ã”é€£çµ¡ã„ãŸã—ã¾ã™ã€‚';\n  \n  results.push({\n    json: {\n      ...original,\n      replyDraft: replyDraft,\n      replySubject: `Re: ${original.subject || ''}`,\n      status: 'æ‰¿èªå¾…ã¡'\n    }\n  });\n}\n\nreturn results;"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[1500,60],"id":"code-merge-reply","name":"è¿”ä¿¡çµæœãƒãƒ¼ã‚¸"},{"parameters":{"operation":"createDraft","sendTo":"={{ $json.from }}","subject":"={{ $json.replySubject }}","message":"={{ $json.replyDraft }}","options":{"threadId":"={{ $json.threadId }}"}},"type":"n8n-nodes-base.gmail","typeVersion":2.1,"position":[1680,60],"id":"gmail-draft","name":"Gmailä¸‹æ›¸ãä¿å­˜","credentials":{"gmailOAuth2":{"id":"","name":"Gmail OAuth2"}}},{"parameters":{"mode":"runOnceForAllItems","jsCode":"// ä¸‹æ›¸ãä¿å­˜çµæœã‚’çµ±åˆã—ã€ã‚·ãƒ¼ãƒˆè¨˜éŒ²ç”¨ãƒ‡ãƒ¼ã‚¿ã‚’æº–å‚™\nconst items = $input.all();\nconst replyData = $('è¿”ä¿¡çµæœãƒãƒ¼ã‚¸').all();\nconst results = [];\n\nfor (let i = 0; i < items.length; i++) {\n  const draftResult = items[i].json;\n  const original = replyData[i]?.json || {};\n  \n  // è¡Œç•ªå·ã¯å¾Œã§Sheetsã‹ã‚‰å–å¾—ã™ã‚‹ãŸã‚ä»®ç½®ã\n  const rowId = `row_${Date.now()}_${i}`;\n  \n  results.push({\n    json: {\n      ...original,\n      draftId: draftResult.id || draftResult.draftId || '',\n      draftUrl: `https://mail.google.com/mail/u/0/#drafts/${draftResult.id || ''}`,\n      rowId: rowId,\n      createdAt: new Date().toISOString()\n    }\n  });\n}\n\nreturn results;"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[1860,60],"id":"code-prepare-sheet","name":"ã‚·ãƒ¼ãƒˆè¨˜éŒ²æº–å‚™"},{"parameters":{"operation":"append","documentId":{"__rl":true,"mode":"id","value":""},"sheetName":{"__rl":true,"mode":"name","value":"={{ $json.genre }}"},"columns":{"mappingMode":"defineBelow","value":{"ãƒ¡ãƒ¼ãƒ«ID":"={{ $json.messageId }}","ã‚¹ãƒ¬ãƒƒãƒ‰ID":"={{ $json.threadId }}","å—ä¿¡æ—¥æ™‚":"={{ $json.receivedAt }}","å·®å‡ºäºº":"={{ $json.from }}","ä»¶å":"={{ $json.subject }}","é‡è¦åº¦":"={{ $json.priority }}","è¿”ä¿¡æ¡ˆ":"={{ $json.replyDraft }}","ä¸‹æ›¸ãID":"={{ $json.draftId }}","ä¸‹æ›¸ãURL":"={{ $json.draftUrl }}","ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹":"={{ $json.status }}","ä½œæˆæ—¥æ™‚":"={{ $json.createdAt }}"},"matchingColumns":[],"schema":[{"id":"ãƒ¡ãƒ¼ãƒ«ID","displayName":"ãƒ¡ãƒ¼ãƒ«ID","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"ã‚¹ãƒ¬ãƒƒãƒ‰ID","displayName":"ã‚¹ãƒ¬ãƒƒãƒ‰ID","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":false},{"id":"å—ä¿¡æ—¥æ™‚","displayName":"å—ä¿¡æ—¥æ™‚","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":false},{"id":"å·®å‡ºäºº","displayName":"å·®å‡ºäºº","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":false},{"id":"ä»¶å","displayName":"ä»¶å","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":false},{"id":"é‡è¦åº¦","displayName":"é‡è¦åº¦","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":false},{"id":"è¿”ä¿¡æ¡ˆ","displayName":"è¿”ä¿¡æ¡ˆ","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":false},{"id":"ä¸‹æ›¸ãID","displayName":"ä¸‹æ›¸ãID","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":false},{"id":"ä¸‹æ›¸ãURL","displayName":"ä¸‹æ›¸ãURL","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":false},{"id":"ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹","displayName":"ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":false},{"id":"ä½œæˆæ—¥æ™‚","displayName":"ä½œæˆæ—¥æ™‚","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":false}]},"options":{}},"type":"n8n-nodes-base.googleSheets","typeVersion":4.5,"position":[2040,60],"id":"sheets-record","name":"Sheetsè¨˜éŒ²","credentials":{"googleSheetsOAuth2Api":{"id":"","name":"Google Sheets OAuth2"}}},{"parameters":{"mode":"runOnceForAllItems","jsCode":"// Slack Block Kitå½¢å¼ã®æ‰¿èªãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ç”Ÿæˆ\nconst items = $input.all();\nconst sheetData = $('ã‚·ãƒ¼ãƒˆè¨˜éŒ²æº–å‚™').all();\nconst results = [];\n\nfor (let i = 0; i < items.length; i++) {\n  const data = sheetData[i]?.json || {};\n  \n  // é‡è¦åº¦ã«å¿œã˜ãŸçµµæ–‡å­—\n  const priorityEmoji = {\n    'high': 'ğŸ”´',\n    'medium': 'ğŸŸ¡',\n    'low': 'ğŸŸ¢'\n  }[data.priority] || 'âšª';\n  \n  // Block Kitæ§‹é€ \n  const blocks = [\n    {\n      \"type\": \"header\",\n      \"text\": {\n        \"type\": \"plain_text\",\n        \"text\": `${priorityEmoji} æ–°ç€ãƒ¡ãƒ¼ãƒ«æ‰¿èªä¾é ¼`,\n        \"emoji\": true\n      }\n    },\n    {\n      \"type\": \"section\",\n      \"fields\": [\n        { \"type\": \"mrkdwn\", \"text\": `*å·®å‡ºäºº:*\\n${data.from}` },\n        { \"type\": \"mrkdwn\", \"text\": `*ã‚¸ãƒ£ãƒ³ãƒ«:*\\n${data.genre}` },\n        { \"type\": \"mrkdwn\", \"text\": `*é‡è¦åº¦:*\\n${data.priority}` },\n        { \"type\": \"mrkdwn\", \"text\": `*å—ä¿¡æ—¥æ™‚:*\\n${data.receivedAt}` }\n      ]\n    },\n    {\n      \"type\": \"section\",\n      \"text\": {\n        \"type\": \"mrkdwn\",\n        \"text\": `*ä»¶å:* ${data.subject}`\n      }\n    },\n    {\n      \"type\": \"divider\"\n    },\n    {\n      \"type\": \"section\",\n      \"text\": {\n        \"type\": \"mrkdwn\",\n        \"text\": `*ğŸ“ AIè¿”ä¿¡æ¡ˆ:*\\n\\`\\`\\`${(data.replyDraft || '').substring(0, 500)}\\`\\`\\``\n      }\n    },\n    {\n      \"type\": \"actions\",\n      \"elements\": [\n        {\n          \"type\": \"button\",\n          \"text\": { \"type\": \"plain_text\", \"text\": \"âœ… æ‰¿èªé€ä¿¡\", \"emoji\": true },\n          \"style\": \"primary\",\n          \"value\": `${data.genre}|${data.messageId}|${data.draftId}|approve`,\n          \"action_id\": \"approve_send\"\n        },\n        {\n          \"type\": \"button\",\n          \"text\": { \"type\": \"plain_text\", \"text\": \"âœï¸ Gmailã§ç·¨é›†\", \"emoji\": true },\n          \"url\": data.draftUrl,\n          \"value\": `${data.genre}|${data.messageId}|${data.draftId}|edit`,\n          \"action_id\": \"edit_gmail\"\n        },\n        {\n          \"type\": \"button\",\n          \"text\": { \"type\": \"plain_text\", \"text\": \"âŒ å´ä¸‹\", \"emoji\": true },\n          \"style\": \"danger\",\n          \"value\": `${data.genre}|${data.messageId}|${data.draftId}|reject`,\n          \"action_id\": \"reject\"\n        }\n      ]\n    }\n  ];\n  \n  results.push({\n    json: {\n      ...data,\n      slackBlocks: blocks,\n      slackText: `${priorityEmoji} [${data.genre}] ${data.subject} - æ‰¿èªå¾…ã¡`\n    }\n  });\n}\n\nreturn results;"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[2220,60],"id":"code-slack-format","name":"Slacké€šçŸ¥æ•´å½¢"},{"parameters":{"select":"user","user":{"__rl":true,"mode":"id","value":"U0965SWD49W"},"text":"={{ $json.slackText }}","blocksUi":"={{ JSON.stringify($json.slackBlocks) }}","otherOptions":{}},"type":"n8n-nodes-base.slack","typeVersion":2.2,"position":[2400,60],"id":"slack-approval","name":"Slackæ‰¿èªä¾é ¼","credentials":{"slackOAuth2Api":{"id":"","name":"Slack OAuth2"}}},{"parameters":{},"type":"n8n-nodes-base.errorTrigger","typeVersion":1,"position":[380,340],"id":"error-trigger","name":"Error Trigger"},{"parameters":{"select":"user","user":{"__rl":true,"mode":"id","value":"U0965SWD49W"},"text":"=âš ï¸ Gmail AIåˆ†æãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã§ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚\n\nã‚¨ãƒ©ãƒ¼: {{ $json.error.message }}\nãƒãƒ¼ãƒ‰: {{ $json.error.node }}\nç™ºç”Ÿæ™‚åˆ»: {{ $now.format('yyyy-MM-dd HH:mm:ss') }}","otherOptions":{}},"type":"n8n-nodes-base.slack","typeVersion":2.2,"position":[560,340],"id":"slack-error","name":"ã‚¨ãƒ©ãƒ¼é€šçŸ¥","credentials":{"slackOAuth2Api":{"id":"","name":"Slack OAuth2"}}},{"parameters":{"operation":"append","documentId":{"__rl":true,"mode":"id","value":""},"sheetName":{"__rl":true,"mode":"name","value":"={{ $json.genre }}"},"columns":{"mappingMode":"defineBelow","value":{"ãƒ¡ãƒ¼ãƒ«ID":"={{ $json.messageId }}","ã‚¹ãƒ¬ãƒƒãƒ‰ID":"={{ $json.threadId }}","å—ä¿¡æ—¥æ™‚":"={{ $json.receivedAt }}","å·®å‡ºäºº":"={{ $json.from }}","ä»¶å":"={{ $json.subject }}","é‡è¦åº¦":"={{ $json.priority }}","ã‚¸ãƒ£ãƒ³ãƒ«":"={{ $json.genre }}","ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹":"=è¿”ä¿¡ä¸è¦","ä½œæˆæ—¥æ™‚":"={{ $json.analyzedAt }}"},"matchingColumns":[],"schema":[{"id":"ãƒ¡ãƒ¼ãƒ«ID","displayName":"ãƒ¡ãƒ¼ãƒ«ID","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"ã‚¹ãƒ¬ãƒƒãƒ‰ID","displayName":"ã‚¹ãƒ¬ãƒƒãƒ‰ID","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":false},{"id":"å—ä¿¡æ—¥æ™‚","displayName":"å—ä¿¡æ—¥æ™‚","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":false},{"id":"å·®å‡ºäºº","displayName":"å·®å‡ºäºº","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":false},{"id":"ä»¶å","displayName":"ä»¶å","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":false},{"id":"é‡è¦åº¦","displayName":"é‡è¦åº¦","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":false},{"id":"ã‚¸ãƒ£ãƒ³ãƒ«","displayName":"ã‚¸ãƒ£ãƒ³ãƒ«","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":false},{"id":"ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹","displayName":"ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":false},{"id":"ä½œæˆæ—¥æ™‚","displayName":"ä½œæˆæ—¥æ™‚","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":false}]},"options":{}},"type":"n8n-nodes-base.googleSheets","typeVersion":4.5,"position":[1320,240],"id":"sheets-no-reply","name":"Sheetsè¨˜éŒ²(è¿”ä¿¡ä¸è¦)","credentials":{"googleSheetsOAuth2Api":{"id":"","name":"Google Sheets OAuth2"}}}],"connections":{"Gmail Trigger":{"main":[[{"node":"ãƒ‡ãƒ¼ã‚¿æº–å‚™","type":"main","index":0}]]},"ãƒ‡ãƒ¼ã‚¿æº–å‚™":{"main":[[{"node":"AIãƒˆãƒªã‚¢ãƒ¼ã‚¸","type":"main","index":0}]]},"Claude (ãƒˆãƒªã‚¢ãƒ¼ã‚¸)":{"ai_languageModel":[[{"node":"AIãƒˆãƒªã‚¢ãƒ¼ã‚¸","type":"ai_languageModel","index":0}]]},"ãƒˆãƒªã‚¢ãƒ¼ã‚¸Parser":{"ai_outputParser":[[{"node":"AIãƒˆãƒªã‚¢ãƒ¼ã‚¸","type":"ai_outputParser","index":0}]]},"AIãƒˆãƒªã‚¢ãƒ¼ã‚¸":{"main":[[{"node":"ãƒˆãƒªã‚¢ãƒ¼ã‚¸çµæœãƒãƒ¼ã‚¸","type":"main","index":0}]]},"ãƒˆãƒªã‚¢ãƒ¼ã‚¸çµæœãƒãƒ¼ã‚¸":{"main":[[{"node":"è¿”ä¿¡è¦å¦åˆ¤å®š","type":"main","index":0}]]},"è¿”ä¿¡è¦å¦åˆ¤å®š":{"main":[[{"node":"AIè¿”ä¿¡ç”Ÿæˆ","type":"main","index":0}],[{"node":"Sheetsè¨˜éŒ²(è¿”ä¿¡ä¸è¦)","type":"main","index":0}]]},"Claude (è¿”ä¿¡)":{"ai_languageModel":[[{"node":"AIè¿”ä¿¡ç”Ÿæˆ","type":"ai_languageModel","index":0}]]},"è¿”ä¿¡Parser":{"ai_outputParser":[[{"node":"AIè¿”ä¿¡ç”Ÿæˆ","type":"ai_outputParser","index":0}]]},"AIè¿”ä¿¡ç”Ÿæˆ":{"main":[[{"node":"è¿”ä¿¡çµæœãƒãƒ¼ã‚¸","type":"main","index":0}]]},"è¿”ä¿¡çµæœãƒãƒ¼ã‚¸":{"main":[[{"node":"Gmailä¸‹æ›¸ãä¿å­˜","type":"main","index":0}]]},"Gmailä¸‹æ›¸ãä¿å­˜":{"main":[[{"node":"ã‚·ãƒ¼ãƒˆè¨˜éŒ²æº–å‚™","type":"main","index":0}]]},"ã‚·ãƒ¼ãƒˆè¨˜éŒ²æº–å‚™":{"main":[[{"node":"Sheetsè¨˜éŒ²","type":"main","index":0}]]},"Sheetsè¨˜éŒ²":{"main":[[{"node":"Slacké€šçŸ¥æ•´å½¢","type":"main","index":0}]]},"Slacké€šçŸ¥æ•´å½¢":{"main":[[{"node":"Slackæ‰¿èªä¾é ¼","type":"main","index":0}]]},"Error Trigger":{"main":[[{"node":"ã‚¨ãƒ©ãƒ¼é€šçŸ¥","type":"main","index":0}]]}},"settings":{"executionOrder":"v1","saveManualExecutions":true,"callerPolicy":"workflowsFromSameOwner","errorWorkflow":""},"staticData":null,"meta":{"templateCredsSetupCompleted":true}}
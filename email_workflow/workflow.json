{"name":"AI","nodes":[{"parameters":{"content":"## ã‚¬ãƒ«ãƒ¼ãƒ³ãƒ¡ãƒ¼ãƒ«AIåˆ†æ & é•·æœŸè¨˜æ†¶ã‚·ã‚¹ãƒ†ãƒ \n\n### å½¹å‰²ãƒ»ç›®çš„\nGaroonã§å—ä¿¡ã—ãŸãƒ¡ãƒ¼ãƒ«ã‚’AI(Claude Haiku)ãŒåˆ†æãƒ»åˆ†é¡ã—ã€éå»ã®ã‚„ã‚Šå–ã‚Šã‚’MongoDBã‹ã‚‰å‚ç…§ã—ã¦è¿”ä¿¡æ¡ˆã‚’ç”Ÿæˆã€‚é‡è¦ãƒ¡ãƒ¼ãƒ«ã®ã¿LINE WORKSã¸é€šçŸ¥ã—ã€å…¨ãƒ‡ãƒ¼ã‚¿ã‚’Google Sheetsã«è¨˜éŒ²ã—ã¾ã™ã€‚\n\n### ä½¿ç”¨ãƒ„ãƒ¼ãƒ«ä¸€è¦§\n- **Webhook**: Garoonã‹ã‚‰ã®ãƒ¡ãƒ¼ãƒ«å—ä¿¡ãƒˆãƒªã‚¬ãƒ¼\n- **Respond to Webhook**: Garoonã¸ã®å³æ™‚å¿œç­”ï¼ˆã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆé˜²æ­¢ï¼‰\n- **Code**: ãƒ‡ãƒ¼ã‚¿æ•´å½¢ãƒ»è¿·æƒ‘ãƒ¡ãƒ¼ãƒ«åˆ¤å®šãƒ»AIå‡ºåŠ›æ¤œè¨¼\n- **OpenAI Embeddings**: ãƒ¡ãƒ¼ãƒ«æœ¬æ–‡ã®ãƒ™ã‚¯ãƒˆãƒ«åŒ–\n- **MongoDB Atlas Vector Store**: é¡ä¼¼ãƒ¡ãƒ¼ãƒ«ã®æ¤œç´¢ãƒ»ä¿å­˜\n- **AI Agent + Claude Haiku**: ãƒ¡ãƒ¼ãƒ«åˆ†æãƒ»åˆ†é¡ãƒ»è¿”ä¿¡æ¡ˆç”Ÿæˆ\n- **Structured Output Parser**: AIå‡ºåŠ›ã®JSONæ§‹é€ åŒ–\n- **Switch**: é‡è¦åº¦ã«åŸºã¥ãå‡¦ç†åˆ†å²\n- **HTTP Request**: Garoon APIãƒ»LINE WORKS APIé€£æº\n- **Google Sheets**: åˆ†æçµæœã®è¨˜éŒ²\n\n### ãƒ•ãƒ­ãƒ¼æ¦‚è¦\n1. Garoon Webhookå—ä¿¡ â†’ 2. å³æ™‚å¿œç­” â†’ 3. ãƒ‡ãƒ¼ã‚¿æ•´å½¢ â†’ 4. ãƒ™ã‚¯ãƒˆãƒ«æ¤œç´¢(é¡ä¼¼ãƒ¡ãƒ¼ãƒ«å–å¾—) â†’ 5. AIåˆ†æ â†’ 6. ãƒ™ã‚¯ãƒˆãƒ«ä¿å­˜ â†’ 7. é‡è¦åº¦åˆ†å² â†’ 8. Garoonä¸‹æ›¸ã/LINE WORKSé€šçŸ¥/Sheetsè¨˜éŒ²\n\n### â˜…è¦è¨­å®šé …ç›®ï¼ˆå‹•ä½œã«å¿…è¦ï¼‰\n1. **Webhook**: Garoonå´ã§ã“ã®Webhook URLã‚’è¨­å®š\n2. **OpenAI Embeddings**: OpenAI APIèªè¨¼æƒ…å ±\n3. **MongoDB Atlas Vector Store (æ¤œç´¢/ä¿å­˜)**: MongoDBæ¥ç¶šæƒ…å ±ã€ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹åã€ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³åã€ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹å\n4. **Anthropic Chat Model**: Anthropic APIèªè¨¼æƒ…å ±ã€ãƒ¢ãƒ‡ãƒ«å(claude-3-haiku-20240307)\n5. **MongoDB Chat Memory**: MongoDBæ¥ç¶šæƒ…å ±ã€ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹åã€ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³å\n6. **HTTP Request (Garoon)**: Garoon API URLã€èªè¨¼ãƒˆãƒ¼ã‚¯ãƒ³\n7. **HTTP Request (LINE WORKS)**: LINE WORKS Bot API URLã€ã‚¢ã‚¯ã‚»ã‚¹ãƒˆãƒ¼ã‚¯ãƒ³\n8. **Google Sheets**: Google OAuth2èªè¨¼ã€ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆIDã€ã‚·ãƒ¼ãƒˆå\n\n### é–¢é€£ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ï¼ˆåˆ¥é€”ä½œæˆãŒå¿…è¦ï¼‰\n- ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼2: æœªè¿”ä¿¡ãƒªãƒã‚¤ãƒ³ãƒ€ãƒ¼ï¼ˆæ¯æ—¥9æ™‚ï¼‰\n- ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼3: ã‚¹ã‚­ãƒƒãƒ—å‡¦ç†ï¼ˆLINE WORKSãƒœã‚¿ãƒ³æ“ä½œï¼‰\n- ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼4: æœˆæ¬¡ãƒ¬ãƒãƒ¼ãƒˆï¼ˆæ¯æœˆ1æ—¥10æ™‚ï¼‰","height":680,"width":520,"color":7},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[-200,-100],"id":"sticky-overview","name":"ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼æ¦‚è¦"},{"parameters":{"content":"## ãƒˆãƒªã‚¬ãƒ¼ & åˆæœŸå‡¦ç†\n\nGaroonã‹ã‚‰ã®Webhookå—ä¿¡å¾Œã€å³åº§ã«200å¿œç­”ã‚’è¿”ã—ã¦ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã‚’é˜²æ­¢ã€‚ãã®å¾Œã€ãƒ¡ãƒ¼ãƒ«ãƒ‡ãƒ¼ã‚¿ã‚’æ•´å½¢ã—è¿·æƒ‘ãƒ¡ãƒ¼ãƒ«ã‚’åˆ¤å®šã—ã¾ã™ã€‚","height":180,"width":360,"color":4},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[360,-100],"id":"sticky-trigger","name":"ãƒˆãƒªã‚¬ãƒ¼èª¬æ˜"},{"parameters":{"content":"## AIåˆ†æå‡¦ç†\n\nOpenAI Embeddingsã§ãƒ™ã‚¯ãƒˆãƒ«åŒ–ã—ã€MongoDB Vector Storeã§é¡ä¼¼ãƒ¡ãƒ¼ãƒ«ã‚’æ¤œç´¢ã€‚ãã®çµæœã‚’ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã¨ã—ã¦AI Agentã«æ¸¡ã—ã€åˆ†é¡ãƒ»è¿”ä¿¡æ¡ˆã‚’ç”Ÿæˆã—ã¾ã™ã€‚","height":180,"width":400,"color":5},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[740,-100],"id":"sticky-ai","name":"AIå‡¦ç†èª¬æ˜"},{"parameters":{"content":"## å‡ºåŠ›ãƒ»é€šçŸ¥å‡¦ç†\n\nAIã®åˆ†æçµæœã‚’æ¤œè¨¼å¾Œã€é‡è¦åº¦ã«å¿œã˜ã¦Garoonä¸‹æ›¸ãä¿å­˜ã€LINE WORKSé€šçŸ¥ã€Google Sheetsè¨˜éŒ²ã‚’è¡Œã„ã¾ã™ã€‚","height":180,"width":400,"color":6},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[1560,-100],"id":"sticky-output","name":"å‡ºåŠ›å‡¦ç†èª¬æ˜"},{"parameters":{"httpMethod":"POST","path":"garoon-mail-webhook","responseMode":"responseNode","options":{}},"type":"n8n-nodes-base.webhook","typeVersion":2,"position":[400,140],"id":"webhook-garoon","name":"Garoon Webhook","webhookId":"garoon-mail-receiver"},{"parameters":{"respondWith":"json","responseBody":"={\"status\": \"received\", \"timestamp\": \"{{ $now.toISO() }}\"}","options":{}},"type":"n8n-nodes-base.respondToWebhook","typeVersion":1.1,"position":[600,140],"id":"respond-webhook","name":"å³æ™‚å¿œç­”"},{"parameters":{"mode":"runOnceForAllItems","jsCode":"// Garoonãƒ¡ãƒ¼ãƒ«ãƒ‡ãƒ¼ã‚¿ã®æ•´å½¢ã¨è¿·æƒ‘ãƒ¡ãƒ¼ãƒ«åˆ¤å®š\nconst items = $input.all();\nconst results = [];\n\nfor (const item of items) {\n  const mailData = item.json.body || item.json;\n  \n  // ãƒ¡ãƒ¼ãƒ«ãƒ‡ãƒ¼ã‚¿ã®æŠ½å‡º\n  const email = {\n    id: mailData.id || `mail_${Date.now()}`,\n    from: mailData.from || '',\n    to: mailData.to || '',\n    subject: mailData.subject || '(ä»¶åãªã—)',\n    body: mailData.body || mailData.content || '',\n    receivedAt: mailData.receivedAt || new Date().toISOString(),\n    threadId: mailData.threadId || null\n  };\n  \n  // è¿·æƒ‘ãƒ¡ãƒ¼ãƒ«åˆ¤å®šï¼ˆç°¡æ˜“ç‰ˆï¼‰\n  const spamKeywords = ['åºƒå‘Š', 'é…ä¿¡åœæ­¢', 'unsubscribe', 'ç„¡æ–™', 'å½“é¸'];\n  const isSpam = spamKeywords.some(keyword => \n    email.subject.toLowerCase().includes(keyword.toLowerCase()) ||\n    email.body.toLowerCase().includes(keyword.toLowerCase())\n  );\n  \n  // ã‚»ãƒƒã‚·ãƒ§ãƒ³IDã®ç”Ÿæˆï¼ˆä¼šè©±å±¥æ­´ç”¨ï¼‰\n  const sessionId = email.threadId || email.from.replace(/[^a-zA-Z0-9]/g, '_');\n  \n  results.push({\n    json: {\n      ...email,\n      isSpam,\n      sessionId,\n      processedAt: new Date().toISOString()\n    }\n  });\n}\n\nreturn results;"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[800,140],"id":"code-parse","name":"ãƒ‡ãƒ¼ã‚¿æ•´å½¢ãƒ»è¿·æƒ‘åˆ¤å®š"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict"},"conditions":[{"id":"condition-spam","leftValue":"={{ $json.isSpam }}","rightValue":false,"operator":{"type":"boolean","operation":"equals"}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[1000,140],"id":"if-not-spam","name":"è¿·æƒ‘ãƒ¡ãƒ¼ãƒ«é™¤å¤–"},{"parameters":{"model":"text-embedding-ada-002","options":{}},"type":"@n8n/n8n-nodes-langchain.embeddingsOpenAi","typeVersion":1.1,"position":[1200,340],"id":"embeddings-openai","name":"OpenAI Embeddings","credentials":{"openAiApi":{"id":"","name":"OpenAI API"}}},{"parameters":{"mode":"retrieve","databaseName":"garoon_mail_db","collectionName":"mail_vectors","indexName":"mail_vector_index","options":{"topK":5}},"type":"@n8n/n8n-nodes-langchain.vectorStoreMongoDBAtlas","typeVersion":1.1,"position":[1200,140],"id":"vector-search","name":"é¡ä¼¼ãƒ¡ãƒ¼ãƒ«æ¤œç´¢","credentials":{"mongoDbApi":{"id":"","name":"MongoDB Atlas"}}},{"parameters":{"mode":"runOnceForAllItems","jsCode":"// é¡ä¼¼ãƒ¡ãƒ¼ãƒ«æ¤œç´¢çµæœã‚’ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆç”¨ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã«æ•´å½¢\nconst items = $input.all();\nconst originalMail = items[0].json;\n\n// Vector Storeæ¤œç´¢çµæœã®å–å¾—\nlet similarContext = '';\ntry {\n  const vectorResults = $('é¡ä¼¼ãƒ¡ãƒ¼ãƒ«æ¤œç´¢').all();\n  if (vectorResults && vectorResults.length > 0) {\n    similarContext = vectorResults\n      .map((doc, i) => `\\nã€éå»ãƒ¡ãƒ¼ãƒ«${i+1}ã€‘\\nä»¶å: ${doc.json.subject || 'ãªã—'}\\nå†…å®¹: ${(doc.json.body || '').substring(0, 300)}...`)\n      .join('\\n');\n  }\n} catch (e) {\n  similarContext = '(éå»ã®é¡ä¼¼ãƒ¡ãƒ¼ãƒ«ã¯è¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸ)';\n}\n\nreturn [{\n  json: {\n    ...originalMail,\n    similarMailsContext: similarContext,\n    promptText: `\nã€æ–°ç€ãƒ¡ãƒ¼ãƒ«ã€‘\nå·®å‡ºäºº: ${originalMail.from}\nä»¶å: ${originalMail.subject}\næœ¬æ–‡:\n${originalMail.body}\n\nã€å‚è€ƒï¼šéå»ã®é¡ä¼¼ãƒ¡ãƒ¼ãƒ«ã€‘\n${similarContext}\n\nä¸Šè¨˜ã®ãƒ¡ãƒ¼ãƒ«ã‚’åˆ†æã—ã€ä»¥ä¸‹ã®å½¢å¼ã§JSONã‚’å‡ºåŠ›ã—ã¦ãã ã•ã„ã€‚\n`\n  }\n}];"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[1400,140],"id":"code-context","name":"ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆç”Ÿæˆ"},{"parameters":{"promptType":"define","text":"={{ $json.promptText }}","hasOutputParser":true,"options":{"systemMessage":"ã‚ãªãŸã¯ãƒ¡ãƒ¼ãƒ«åˆ†æã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆã§ã™ã€‚Garoonã§å—ä¿¡ã—ãŸãƒ¡ãƒ¼ãƒ«ã‚’åˆ†æã—ã€é©åˆ‡ãªåˆ†é¡ã¨è¿”ä¿¡æ¡ˆã‚’ç”Ÿæˆã—ã¾ã™ã€‚\n\nã€åˆ†æãƒ«ãƒ¼ãƒ«ã€‘\n1. ã‚¸ãƒ£ãƒ³ãƒ«: å•ã„åˆã‚ã› / è¦‹ç©ä¾é ¼ / ã‚¯ãƒ¬ãƒ¼ãƒ  / å ±å‘Š / ãŠçŸ¥ã‚‰ã› / ãã®ä»–\n2. é‡è¦åº¦: é«˜(ç·Šæ€¥å¯¾å¿œå¿…è¦) / ä¸­(å½“æ—¥ä¸­å¯¾å¿œ) / ä½(å¯¾å¿œä¸è¦ã¾ãŸã¯å¾Œæ—¥å¯)\n3. è¿”ä¿¡æ¡ˆ: ä¸å¯§ã§ç°¡æ½”ãªè¿”ä¿¡æ–‡ã‚’ç”Ÿæˆ\n\nã€åˆ¤æ–­åŸºæº–ã€‘\n- ã€Œè‡³æ€¥ã€ã€Œç·Šæ€¥ã€ã€Œæœ¬æ—¥ä¸­ã€ãªã©ã®æ–‡è¨€ â†’ é‡è¦åº¦:é«˜\n- è¦‹ç©ä¾é ¼ã€ã‚¯ãƒ¬ãƒ¼ãƒ  â†’ é‡è¦åº¦:é«˜\n- ç¤¾å¤–ã‹ã‚‰ã®å•ã„åˆã‚ã› â†’ é‡è¦åº¦:ä¸­\n- CCå—ä¿¡ã€ãŠçŸ¥ã‚‰ã› â†’ é‡è¦åº¦:ä½\n\néå»ã®é¡ä¼¼ãƒ¡ãƒ¼ãƒ«ãŒã‚ã‚‹å ´åˆã¯ã€ãã®å¯¾å¿œã‚’å‚è€ƒã«ã—ã¦ãã ã•ã„ã€‚"}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":1.7,"position":[1600,140],"id":"ai-agent","name":"ãƒ¡ãƒ¼ãƒ«åˆ†æAI Agent"},{"parameters":{"modelId":{"__rl":true,"mode":"list","value":"claude-3-haiku-20240307"},"options":{"maxTokensToSample":2048,"temperature":0.3}},"type":"@n8n/n8n-nodes-langchain.lmChatAnthropic","typeVersion":1.3,"position":[1480,340],"id":"llm-anthropic","name":"Claude Haiku","credentials":{"anthropicApi":{"id":"","name":"Anthropic API"}}},{"parameters":{"sessionIdType":"customKey","sessionKey":"={{ $('ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆç”Ÿæˆ').item.json.sessionId }}","databaseName":"garoon_mail_db","collectionName":"chat_history","options":{"contextWindowLength":10}},"type":"@n8n/n8n-nodes-langchain.memoryMongoDbChat","typeVersion":1.1,"position":[1600,340],"id":"memory-mongodb","name":"MongoDB Chat Memory","credentials":{"mongoDbApi":{"id":"","name":"MongoDB Atlas"}}},{"parameters":{"schemaType":"manual","inputSchema":"{\n  \"type\": \"object\",\n  \"properties\": {\n    \"genre\": {\n      \"type\": \"string\",\n      \"description\": \"ãƒ¡ãƒ¼ãƒ«ã®ã‚¸ãƒ£ãƒ³ãƒ«ï¼ˆå•ã„åˆã‚ã›/è¦‹ç©ä¾é ¼/ã‚¯ãƒ¬ãƒ¼ãƒ /å ±å‘Š/ãŠçŸ¥ã‚‰ã›/ãã®ä»–ï¼‰\"\n    },\n    \"importance\": {\n      \"type\": \"string\",\n      \"description\": \"é‡è¦åº¦ï¼ˆé«˜/ä¸­/ä½ï¼‰\"\n    },\n    \"summary\": {\n      \"type\": \"string\",\n      \"description\": \"ãƒ¡ãƒ¼ãƒ«å†…å®¹ã®è¦ç´„ï¼ˆ50æ–‡å­—ä»¥å†…ï¼‰\"\n    },\n    \"replyDraft\": {\n      \"type\": \"string\",\n      \"description\": \"è¿”ä¿¡æ¡ˆã®æœ¬æ–‡\"\n    },\n    \"actionRequired\": {\n      \"type\": \"boolean\",\n      \"description\": \"ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãŒå¿…è¦ã‹ã©ã†ã‹\"\n    },\n    \"suggestedDeadline\": {\n      \"type\": \"string\",\n      \"description\": \"æ¨å¥¨å¯¾å¿œæœŸé™ï¼ˆä¾‹: æœ¬æ—¥ä¸­ã€3æ—¥ä»¥å†…ã€ãªã—ï¼‰\"\n    }\n  },\n  \"required\": [\"genre\", \"importance\", \"summary\", \"replyDraft\", \"actionRequired\"]\n}"},"type":"@n8n/n8n-nodes-langchain.outputParserStructured","typeVersion":1.2,"position":[1720,340],"id":"output-parser","name":"Structured Output Parser"},{"parameters":{"mode":"runOnceForAllItems","jsCode":"// AIå‡ºåŠ›ã®æ¤œè¨¼ã¨æ•´å½¢\nconst items = $input.all();\nconst contextData = $('ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆç”Ÿæˆ').first().json;\nconst results = [];\n\nfor (const item of items) {\n  let aiOutput = item.json.output || item.json;\n  \n  // JSONå½¢å¼ã®æ¤œè¨¼\n  const validGenres = ['å•ã„åˆã‚ã›', 'è¦‹ç©ä¾é ¼', 'ã‚¯ãƒ¬ãƒ¼ãƒ ', 'å ±å‘Š', 'ãŠçŸ¥ã‚‰ã›', 'ãã®ä»–'];\n  const validImportance = ['é«˜', 'ä¸­', 'ä½'];\n  \n  // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã®è¨­å®šï¼ˆAIãŒä¸æ­£ãªå€¤ã‚’è¿”ã—ãŸå ´åˆï¼‰\n  if (!validGenres.includes(aiOutput.genre)) {\n    aiOutput.genre = 'ãã®ä»–';\n  }\n  if (!validImportance.includes(aiOutput.importance)) {\n    aiOutput.importance = 'ä¸­';\n  }\n  if (!aiOutput.summary) {\n    aiOutput.summary = contextData.subject.substring(0, 50);\n  }\n  if (!aiOutput.replyDraft) {\n    aiOutput.replyDraft = 'ã”é€£çµ¡ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™ã€‚å†…å®¹ã‚’ç¢ºèªã®ä¸Šã€æ”¹ã‚ã¦ã”é€£çµ¡ã„ãŸã—ã¾ã™ã€‚';\n  }\n  \n  results.push({\n    json: {\n      // å…ƒã®ãƒ¡ãƒ¼ãƒ«ãƒ‡ãƒ¼ã‚¿\n      mailId: contextData.id,\n      from: contextData.from,\n      to: contextData.to,\n      subject: contextData.subject,\n      body: contextData.body,\n      receivedAt: contextData.receivedAt,\n      sessionId: contextData.sessionId,\n      // AIåˆ†æçµæœ\n      genre: aiOutput.genre,\n      importance: aiOutput.importance,\n      summary: aiOutput.summary,\n      replyDraft: aiOutput.replyDraft,\n      actionRequired: aiOutput.actionRequired !== false,\n      suggestedDeadline: aiOutput.suggestedDeadline || 'ãªã—',\n      // ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿\n      analyzedAt: new Date().toISOString(),\n      status: 'æœªè¿”ä¿¡'\n    }\n  });\n}\n\nreturn results;"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[1800,140],"id":"code-validate","name":"AIå‡ºåŠ›æ¤œè¨¼"},{"parameters":{"mode":"insert","databaseName":"garoon_mail_db","collectionName":"mail_vectors","indexName":"mail_vector_index","options":{}},"type":"@n8n/n8n-nodes-langchain.vectorStoreMongoDBAtlas","typeVersion":1.1,"position":[2000,140],"id":"vector-insert","name":"ãƒ¡ãƒ¼ãƒ«ãƒ™ã‚¯ãƒˆãƒ«ä¿å­˜","credentials":{"mongoDbApi":{"id":"","name":"MongoDB Atlas"}}},{"parameters":{"model":"text-embedding-ada-002","options":{}},"type":"@n8n/n8n-nodes-langchain.embeddingsOpenAi","typeVersion":1.1,"position":[2000,340],"id":"embeddings-insert","name":"OpenAI Embeddings (ä¿å­˜ç”¨)","credentials":{"openAiApi":{"id":"","name":"OpenAI API"}}},{"parameters":{"rules":{"values":[{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict"},"conditions":[{"leftValue":"={{ $json.importance }}","rightValue":"é«˜","operator":{"type":"string","operation":"equals"}}],"combinator":"and"},"renameOutput":true,"outputKey":"é‡è¦åº¦é«˜"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict"},"conditions":[{"leftValue":"={{ $json.importance }}","rightValue":"ä¸­","operator":{"type":"string","operation":"equals"}}],"combinator":"and"},"renameOutput":true,"outputKey":"é‡è¦åº¦ä¸­"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict"},"conditions":[{"leftValue":"={{ $json.importance }}","rightValue":"ä½","operator":{"type":"string","operation":"equals"}}],"combinator":"and"},"renameOutput":true,"outputKey":"é‡è¦åº¦ä½"}]},"options":{}},"type":"n8n-nodes-base.switch","typeVersion":3.2,"position":[2200,140],"id":"switch-importance","name":"é‡è¦åº¦åˆ†å²"},{"parameters":{"method":"POST","url":"https://your-garoon-domain.cybozu.com/api/v1/mail/drafts","authentication":"genericCredentialType","genericAuthType":"httpHeaderAuth","sendBody":true,"specifyBody":"json","jsonBody":"={\n  \"to\": \"{{ $json.from }}\",\n  \"subject\": \"Re: {{ $json.subject }}\",\n  \"body\": \"{{ $json.replyDraft }}\",\n  \"inReplyTo\": \"{{ $json.mailId }}\"\n}","options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[2440,40],"id":"http-garoon-draft","name":"Garoonä¸‹æ›¸ãä¿å­˜","credentials":{"httpHeaderAuth":{"id":"","name":"Garoon API Token"}}},{"parameters":{"method":"POST","url":"https://www.worksapis.com/v1.0/bots/your-bot-id/channels/your-channel-id/messages","authentication":"genericCredentialType","genericAuthType":"httpHeaderAuth","sendBody":true,"specifyBody":"json","jsonBody":"={\n  \"content\": {\n    \"type\": \"text\",\n    \"text\": \"ğŸ”´ ã€é‡è¦ãƒ¡ãƒ¼ãƒ«é€šçŸ¥ã€‘\\n\\nå·®å‡ºäºº: {{ $json.from }}\\nä»¶å: {{ $json.subject }}\\nã‚¸ãƒ£ãƒ³ãƒ«: {{ $json.genre }}\\né‡è¦åº¦: {{ $json.importance }}\\n\\nğŸ“ è¦ç´„:\\n{{ $json.summary }}\\n\\nğŸ’¡ æ¨å¥¨å¯¾å¿œæœŸé™: {{ $json.suggestedDeadline }}\\n\\n---\\nğŸ“‹ è¿”ä¿¡æ¡ˆ:\\n{{ $json.replyDraft.substring(0, 500) }}...\"\n  }\n}","options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[2440,180],"id":"http-lineworks-high","name":"LINE WORKSé€šçŸ¥(é«˜)","credentials":{"httpHeaderAuth":{"id":"","name":"LINE WORKS Bot Token"}}},{"parameters":{"method":"POST","url":"https://www.worksapis.com/v1.0/bots/your-bot-id/channels/your-channel-id/messages","authentication":"genericCredentialType","genericAuthType":"httpHeaderAuth","sendBody":true,"specifyBody":"json","jsonBody":"={\n  \"content\": {\n    \"type\": \"text\",\n    \"text\": \"ğŸŸ¡ ã€ãƒ¡ãƒ¼ãƒ«é€šçŸ¥ã€‘\\n\\nå·®å‡ºäºº: {{ $json.from }}\\nä»¶å: {{ $json.subject }}\\nã‚¸ãƒ£ãƒ³ãƒ«: {{ $json.genre }}\\n\\nğŸ“ è¦ç´„: {{ $json.summary }}\"\n  }\n}","options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[2440,360],"id":"http-lineworks-mid","name":"LINE WORKSé€šçŸ¥(ä¸­)","credentials":{"httpHeaderAuth":{"id":"","name":"LINE WORKS Bot Token"}}},{"parameters":{"operation":"append","documentId":{"__rl":true,"mode":"id","value":""},"sheetName":{"__rl":true,"mode":"list","value":"gid=0"},"columns":{"mappingMode":"defineBelow","value":{"ãƒ¡ãƒ¼ãƒ«ID":"={{ $json.mailId }}","å—ä¿¡æ—¥æ™‚":"={{ $json.receivedAt }}","å·®å‡ºäºº":"={{ $json.from }}","ä»¶å":"={{ $json.subject }}","ã‚¸ãƒ£ãƒ³ãƒ«":"={{ $json.genre }}","é‡è¦åº¦":"={{ $json.importance }}","è¦ç´„":"={{ $json.summary }}","è¿”ä¿¡æ¡ˆ":"={{ $json.replyDraft }}","æ¨å¥¨æœŸé™":"={{ $json.suggestedDeadline }}","ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹":"={{ $json.status }}","åˆ†ææ—¥æ™‚":"={{ $json.analyzedAt }}"},"matchingColumns":[],"schema":[{"id":"ãƒ¡ãƒ¼ãƒ«ID","displayName":"ãƒ¡ãƒ¼ãƒ«ID","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"å—ä¿¡æ—¥æ™‚","displayName":"å—ä¿¡æ—¥æ™‚","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":false},{"id":"å·®å‡ºäºº","displayName":"å·®å‡ºäºº","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":false},{"id":"ä»¶å","displayName":"ä»¶å","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":false},{"id":"ã‚¸ãƒ£ãƒ³ãƒ«","displayName":"ã‚¸ãƒ£ãƒ³ãƒ«","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":false},{"id":"é‡è¦åº¦","displayName":"é‡è¦åº¦","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":false},{"id":"è¦ç´„","displayName":"è¦ç´„","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":false},{"id":"è¿”ä¿¡æ¡ˆ","displayName":"è¿”ä¿¡æ¡ˆ","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":false},{"id":"æ¨å¥¨æœŸé™","displayName":"æ¨å¥¨æœŸé™","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":false},{"id":"ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹","displayName":"ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":false},{"id":"åˆ†ææ—¥æ™‚","displayName":"åˆ†ææ—¥æ™‚","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":false}]},"options":{}},"type":"n8n-nodes-base.googleSheets","typeVersion":4.5,"position":[2680,180],"id":"sheets-append","name":"Google Sheetsè¨˜éŒ²","credentials":{"googleSheetsOAuth2Api":{"id":"","name":"Google Sheets OAuth2"}}},{"parameters":{},"type":"n8n-nodes-base.merge","typeVersion":3,"position":[2680,360],"id":"merge-outputs","name":"å‡¦ç†åˆæµ"},{"parameters":{},"type":"n8n-nodes-base.errorTrigger","typeVersion":1,"position":[400,400],"id":"error-trigger","name":"Error Trigger"},{"parameters":{"method":"POST","url":"https://www.worksapis.com/v1.0/bots/your-bot-id/channels/your-channel-id/messages","authentication":"genericCredentialType","genericAuthType":"httpHeaderAuth","sendBody":true,"specifyBody":"json","jsonBody":"={\n  \"content\": {\n    \"type\": \"text\",\n    \"text\": \"âš ï¸ ã€ã‚¨ãƒ©ãƒ¼é€šçŸ¥ã€‘ã‚¬ãƒ«ãƒ¼ãƒ³ãƒ¡ãƒ¼ãƒ«åˆ†æãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã§ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚\\n\\nã‚¨ãƒ©ãƒ¼å†…å®¹: {{ $json.error.message }}\\nç™ºç”Ÿãƒãƒ¼ãƒ‰: {{ $json.error.node }}\\nç™ºç”Ÿæ™‚åˆ»: {{ $now.toISO() }}\"\n  }\n}","options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[600,400],"id":"http-error-notify","name":"ã‚¨ãƒ©ãƒ¼é€šçŸ¥","credentials":{"httpHeaderAuth":{"id":"","name":"LINE WORKS Bot Token"}}}],"connections":{"Garoon Webhook":{"main":[[{"node":"å³æ™‚å¿œç­”","type":"main","index":0}]]},"å³æ™‚å¿œç­”":{"main":[[{"node":"ãƒ‡ãƒ¼ã‚¿æ•´å½¢ãƒ»è¿·æƒ‘åˆ¤å®š","type":"main","index":0}]]},"ãƒ‡ãƒ¼ã‚¿æ•´å½¢ãƒ»è¿·æƒ‘åˆ¤å®š":{"main":[[{"node":"è¿·æƒ‘ãƒ¡ãƒ¼ãƒ«é™¤å¤–","type":"main","index":0}]]},"è¿·æƒ‘ãƒ¡ãƒ¼ãƒ«é™¤å¤–":{"main":[[{"node":"é¡ä¼¼ãƒ¡ãƒ¼ãƒ«æ¤œç´¢","type":"main","index":0}],[]]},"é¡ä¼¼ãƒ¡ãƒ¼ãƒ«æ¤œç´¢":{"main":[[{"node":"ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆç”Ÿæˆ","type":"main","index":0}]]},"OpenAI Embeddings":{"ai_embedding":[[{"node":"é¡ä¼¼ãƒ¡ãƒ¼ãƒ«æ¤œç´¢","type":"ai_embedding","index":0}]]},"ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆç”Ÿæˆ":{"main":[[{"node":"ãƒ¡ãƒ¼ãƒ«åˆ†æAI Agent","type":"main","index":0}]]},"Claude Haiku":{"ai_languageModel":[[{"node":"ãƒ¡ãƒ¼ãƒ«åˆ†æAI Agent","type":"ai_languageModel","index":0}]]},"MongoDB Chat Memory":{"ai_memory":[[{"node":"ãƒ¡ãƒ¼ãƒ«åˆ†æAI Agent","type":"ai_memory","index":0}]]},"Structured Output Parser":{"ai_outputParser":[[{"node":"ãƒ¡ãƒ¼ãƒ«åˆ†æAI Agent","type":"ai_outputParser","index":0}]]},"ãƒ¡ãƒ¼ãƒ«åˆ†æAI Agent":{"main":[[{"node":"AIå‡ºåŠ›æ¤œè¨¼","type":"main","index":0}]]},"AIå‡ºåŠ›æ¤œè¨¼":{"main":[[{"node":"ãƒ¡ãƒ¼ãƒ«ãƒ™ã‚¯ãƒˆãƒ«ä¿å­˜","type":"main","index":0}]]},"OpenAI Embeddings (ä¿å­˜ç”¨)":{"ai_embedding":[[{"node":"ãƒ¡ãƒ¼ãƒ«ãƒ™ã‚¯ãƒˆãƒ«ä¿å­˜","type":"ai_embedding","index":0}]]},"ãƒ¡ãƒ¼ãƒ«ãƒ™ã‚¯ãƒˆãƒ«ä¿å­˜":{"main":[[{"node":"é‡è¦åº¦åˆ†å²","type":"main","index":0}]]},"é‡è¦åº¦åˆ†å²":{"main":[[{"node":"Garoonä¸‹æ›¸ãä¿å­˜","type":"main","index":0},{"node":"LINE WORKSé€šçŸ¥(é«˜)","type":"main","index":0}],[{"node":"LINE WORKSé€šçŸ¥(ä¸­)","type":"main","index":0}],[]]},"Garoonä¸‹æ›¸ãä¿å­˜":{"main":[[{"node":"Google Sheetsè¨˜éŒ²","type":"main","index":0}]]},"LINE WORKSé€šçŸ¥(é«˜)":{"main":[[{"node":"Google Sheetsè¨˜éŒ²","type":"main","index":0}]]},"LINE WORKSé€šçŸ¥(ä¸­)":{"main":[[{"node":"å‡¦ç†åˆæµ","type":"main","index":0}]]},"Google Sheetsè¨˜éŒ²":{"main":[[{"node":"å‡¦ç†åˆæµ","type":"main","index":0}]]},"Error Trigger":{"main":[[{"node":"ã‚¨ãƒ©ãƒ¼é€šçŸ¥","type":"main","index":0}]]}},"settings":{"executionOrder":"v1","saveManualExecutions":true,"callerPolicy":"workflowsFromSameOwner","errorWorkflow":""},"staticData":null,"meta":{"templateCredsSetupCompleted":true}}